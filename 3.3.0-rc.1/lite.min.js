(function(){"use strict";var n={enumerable:!1,configurable:!0,writable:!0},t=this,e=t.Object.defineProperty,r=function(n){var e=t.JSON.stringify(n,function(n,t){return"function"==typeof t?t.toString():t},2);return"\n>>> "+t.String(e).replace(/\n/g,"\n    ")},o=function(n){return void 0!==n},i=function(n){return t.Array.isArray(n)},a=function(n){return"function"==typeof n},u=function(n){return"string"==typeof n},c=function(n){return"number"==typeof n},d=function(n){return!!n&&n.constructor===t.Object},l=function(n){return!!(n&&n.tagName&&n.nodeName&&n.ownerDocument&&n.removeAttribute)},s=function(n){if(void 0!==n)return t.JSON.parse(t.JSON.stringify(n))},f=function(n,e){for(var o=arguments.length,i=t.Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];if(!n)throw new t.Error("@okwolo."+e+i.map(r).join(""))},b=function(){var n=[],t=function(){var t=n[0];t&&t()};return{add:function(e){n.push(e),1===n.length&&t()},done:function(){n.shift(),t()}}},h=function(n,e){if(t.Array.isArray(n))return n;if(t.Symbol.iterator in t.Object(n))return function(n,e){var r=[],o=!0,i=!1,a=void 0;try{for(var u,c=n[t.Symbol.iterator]();!(o=(u=c.next()).done)&&(r.push(u.value),!e||r.length!==e);o=!0);}catch(n){i=!0,a=n}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}return r}(n,e);throw new t.TypeError("Invalid attempt to destructure non-iterable instance")},v=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(n,e){if(!(n instanceof e))throw new t.TypeError("Cannot call a class as a function")}(this,v),this.list=n;for(var e="root",r=0;r<this.list.length;++r){e+=" -> ";var o=this.list[r].tag;e+=o.substr(0,16),o.length>16&&(e+="...")}this.formatted=e},p=v.prototype,g=function(){for(var n=arguments.length,e=t.Array(n),r=0;r<n;r++)e[r]=arguments[r];return e.map(function(n){return u(n)?n:i(n)?g.apply(void 0,function(n){if(t.Array.isArray(n)){for(var e=0,r=t.Array(n.length);e<n.length;e++)r[e]=n[e];return r}return t.Array.from(n)}(n)):d(n)?g(t.Object.keys(n).map(function(t){return n[t]&&t})):void 0}).filter(t.Boolean).join(" ")},y=function(n,e){m.browser&&(o(e)||(f(void 0!==t.window,"app : must be run in a browser environment"),e=t.window));var r,c,l,s=function(){},b=function(){return s.apply(void 0,arguments)};return t.Object.assign(b,(r={},c={},{on:function(n,t){f(u(n),"on : handler type is not a string",n),f(a(t),"on : handler is not a function",t),o(r[n])||(r[n]=[]),r[n].push(t)},send:l=function(n){for(var e=arguments.length,o=t.Array(e>1?e-1:0),a=1;a<e;a++)o[a-1]=arguments[a];f(u(n),"send : event type is not a string",n);var c=r[n];if(i(c))for(var d=0;d<c.length;++d)c[d].apply(c,o)},use:function(n){for(var e=arguments.length,r=t.Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(u(n))l.apply(void 0,["blob."+n].concat(r));else{f(d(n),"use : blob is not an object",n);var a=n.name;if(o(a)){if(f(u(a),"utils.bus : blob name is not a string",a),o(c[a]))return;c[a]=!0}for(var s=t.Object.keys(n),b=0;b<s.length;++b){var h=s[b];l("blob."+h,n[h])}}}})),b.on("blob.api",function(n,e){f(d(n),"on.blob.api : additional api is not an object",n),t.Object.keys(n).forEach(function(t){e||f(!b[t],'on.blob.api : cannot add key "'+t+'" because it is already defined'),b[t]=n[t]})}),b.on("blob.primary",function(n){f(a(n),"on.blob.primary : primary is not a function",n),s=n}),O.forEach(function(n){n({on:b.on,send:b.send},e)}),o(n)&&b.use("target",n),b},m={kit:"lite",browser:!0};n.value=function(n){return void 0===n?this.formatted:this.formatted+" -> {{"+n+"}}"},e(p,"f",n),n.value=function(n,t){return new v(this.list.concat([{tag:n,key:t}]))},e(p,"add",n),n.value=function(n,t){return this.list.push({tag:n,key:t}),this},e(p,"addUnsafe",n),n.value=function(){return new v(this.list.slice())},e(p,"copy",n),n.value=function(){var n=[];if(this.list.length<2)return[];for(var t=1;t<this.list.length;++t)n.push(this.list[t].key);return n},e(p,"keys",n);var w=/:\w+/g,O=[function(n){var t=n.on,e=n.send,r={},o=r,i=void 0;t("state",function(n){o=n}),t("blob.handler",function(n){f(a(n),"on.blob.handler : handler generator is not a function",n);var t=n(function(){return o});f(a(t),"on.blob.handler : handler from generator is not a function",t),i=t}),e("blob.handler",function(){return function(n){e("state",n)}});e("blob.api",{setState:function(n){var t=a(n)?n(s(o)):n;i(t)},getState:function(){return f(o!==r,"state.getState : cannot get state before it has been set"),s(o)}})},function(n){var e=n.on,r=n.send,i=void 0,u=void 0,c=void 0,d=void 0,l=void 0,s=void 0,h=void 0;e("blob.target",function(n){i=n,r("update",!0)}),e("blob.builder",function(n){f(a(n),"on.blob.builder : builder is not a function",n),u=n,r("update",!1)}),e("blob.draw",function(n){f(a(n),"on.blob.draw : new draw is not a function",n),d=n,r("update",!0)}),e("blob.update",function(n){f(a(n),"on.blob.update : new target updater is not a function",n),l=n,r("update",!1)}),e("blob.build",function(n){f(a(n),"on.blob.build : new build is not a function",n),c=n,r("update",!1)}),e("state",function(n){f(o(n),"on.blob.state : new state is not defined",n),h=n,r("update",!1)});var v=!1,p=!1,g=null;e("update",function(n){if(!p){if(!(o(i)&&o(u)&&o(h)))return void(g||(g=t.setTimeout(function(){var n={builder:u,state:h,target:i};t.Object.keys(n).forEach(function(t){n[t]=n[t]?"ok":"waiting"}),f(p,"view : still waiting to draw after "+t.Math.round(3)+"s",n)},3e3)));p=!0}var e=b();if(n||!v)return s=d(i,c(u(h),e)),v=!0,void e.done();s=l(i,c(u(h),e),[],s),e.done()}),e("sync",function(n,t,e){f(v,"view.sync : cannot sync component before app has drawn"),s=l(i,t,n,s,e)}),r("blob.api",{update:function(){t.console.warn("@okwolo.update : function will be deprecated in next major version (4.x)"),r("update",!1)}}),r("blob.primary",function(n){r("blob.builder",n())})},function(n){var e=n.send;e("blob.build",function(n,r){return r.add(t.Function),function n(r,l,s,b,v,p){if("boolean"==typeof r&&(r=""),null===r&&(r=""),c(r)&&(r=""+r),u(r))return v&&s.addUnsafe("textNode",b),{text:r,componentIdentity:p};var y=s.f(b);if(f(i(r),"view.build : vdom object is not a recognized type",y,r),a(r[0])){var m=h(r,3),w=m[0],O=m[1],k=void 0===O?{}:O,j=m[2],M=void 0===j?[]:j;f(d(k),"view.build : component's props is not an object",y,r,k),f(i(M),"view.build : component's children is not an array",y,r,M);var x=void 0,D=s;return v||(D=s.copy(),p={}),x=w(t.Object.assign({},k,{children:M}),function(){for(var r=arguments.length,o=t.Array(r),i=0;i<r;i++)o[i]=arguments[i];l.add(function(){e("sync",D.keys(),n(x.apply(void 0,o),l,D,b,!1,p),p),l.done()})}),f(a(x),"view.build : component should return a function",y,x),n(x(),l,D,b,!0,p)}var A=h(r,3),N=A[0],S=A[1],E=void 0===S?{}:S,C=A[2],I=void 0===C?[]:C;f(u(N),"view.build : tag property is not a string",y,r,N),f(d(E),"view.build : attributes is not an object",y,r,E),f(i(I),"view.build : children of vdom object is not an array",y,r,I);var $=/^ *?(\w+?) *?(?:#([-\w\d]+?))? *?((?:\.[-\w\d]+?)*?)? *?(?:\|\s*?([^\s][^]*?))? *?$/.exec(N);f(i($),"view.build : tag property cannot be parsed",y,N);var T=h($,5),F=T[1],J=T[2],U=T[3],q=T[4];o(J)&&!o(E.id)&&(E.id=J.trim()),(o(E.className)||o(U))&&(E.className=g(E.className,U).replace(/\./g," ").replace(/  +/g," ").trim()),o(q)&&(o(E.style)?(q=(q+";").replace(/;;$/g,";"),E.style=q+E.style):E.style=q);var B=b;"key"in E&&(B=E.key,f(c(B)||u(B),"view.build : invalid element key type",y,B),f((B=""+B).match(/^[\w\d-_]+$/g),"view.build : invalid character in element key",y,B),E.key=B),v?s.addUnsafe(N,B):s=s.add(N,B);for(var R={},z=[],H=0;H<I.length;++H){var L=I[H],P=""+H,V=n(L,l,s,P);V.attributes&&"key"in V.attributes&&(P=V.attributes.key),f(!R[P],"view.build : duplicate child key (note that text elements and elements with no key attribute are given their array index as key)",s.f(),P),z.push(P),R[P]=V}return{tagName:F,attributes:E,children:R,childOrder:z,componentIdentity:p}}(n,r,new v)})},function(n,e){var r=n.send,i=function n(r){if(o(r.text))return r.DOM=e.document.createTextNode(r.text),r;var i=e.document.createElement(r.tagName);t.Object.assign(i,r.attributes);for(var a=0;a<r.childOrder.length;++a){var u=r.childOrder[a],c=n(r.children[u]).DOM;i.appendChild(c)}return r.DOM=i,r},u=function n(e,r,u,c,d){if(o(r)){if(!o(u)){var l=c.DOM,s=r.DOM;return e.push(function(){l.removeChild(s)}),void delete c.children[d]}if(r.componentIdentity=u.componentIdentity,r.tagName!==u.tagName){var f=r.DOM,b=i(u),h=c.DOM,v=b.DOM;return e.push(function(){h.replaceChild(v,f)}),void t.Object.assign(r,{DOM:void 0,text:void 0,tagName:void 0,attributes:void 0,children:void 0,childOrder:void 0},b)}if(void 0===r.text){for(var p=function(n,e){for(var r=t.Object.keys(t.Object.assign({},n,e)),o=[],i=0;i<r.length;++i){var u=r[i],c=n[u],d=e[u];(a(c)||a(d))&&o.push(u),c!==d&&o.push(u)}return o}(r.attributes,u.attributes),g=function(n){var t=p[n],o=u.attributes[t];r.attributes[t]=o;var i=r.DOM;e.push(function(){i[t]=o})},y=0;y<p.length;++y)g(y);var m=r.childOrder.slice();r.childOrder=u.childOrder;var w=t.Object.keys(t.Object.assign({},r.children,u.children));for(y=0;y<w.length;++y){var O=w[y];r.children[O]?u.children[O]||m.splice(m.indexOf(O),1):m.push(O),n(e,r.children[O],u.children[O],r,O)}if(m.length){for(var k=function(n,e){for(var r=e.length,o=r/2,i=0,a=0,u=0;u<r;++u){for(var c=n.indexOf(e[u]),d=t.Math.min(r-c,r-u),l=1,s=1;s<d&&e[u+s]===n[c+s];++s)l+=1;if(l>i&&(i=l,a=u),i>=o)break}return{start:a,end:a+i-1}}(m,u.childOrder),j=k.start,M=k.end,x=u.childOrder.slice(0,j),D=function(n){var t=x[n],o=r.DOM,i=r.children[t].DOM;e.push(function(){o.insertBefore(i,o.firstChild)})},A=x.length-1;A>=0;--A)D(A);for(var N=u.childOrder.slice(M+1,t.Infinity),S=function(n){var t=N[n],o=r.DOM,i=r.children[t].DOM;e.push(function(){o.appendChild(i)})},E=0;E<N.length;++E)S(E)}}else{var C=u.text;if(r.text!==C){var I=r.DOM;e.push(function(){I.nodeValue=C}),r.text=C}}}else{c.children[d]=i(u);var $=c.DOM,T=c.children[d].DOM;e.push(function(){$.appendChild(T)})}};r("blob.draw",function(n,t){return f(l(n),"view.dom.draw : target is not a DOM node",n),i(t),e.requestAnimationFrame(function(){n.innerHTML="",n.appendChild(t.DOM)}),t}),r("blob.update",function(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments[3],a=arguments[4];f(l(n),"view.dom.update : target is not a DOM node",n);for(var c={DOM:n,children:{root:i},childOrder:["root"]},d="root",s=i,b=0;b<o.length;++b)d=o[b],c=s,s=s.children[d];if(a){var h=s.componentIdentity===a;f(h,"view.dom.update : target of update has incorrect identity (this is generally caused by a component update being called on a component that no longer exists)")}var v=[];return u(v,s,r,c,d),e.requestAnimationFrame(function(){try{for(var n=0;n<v.length;++n)v[n]()}catch(n){t.console.error("view.dom.update : "+n)}}),i})},function(n,e){var r=n.on,o=n.send,i=null!==e.document.origin&&"null"!==e.document.origin,c="",l=void 0,s=void 0,h=void 0,v=!1,p=b(),g=function(){for(var n=arguments.length,e=t.Array(n),r=0;r<n;r++)e[r]=arguments[r];f(a(h),"router : fetch is not a function",h),h.apply(void 0,[l].concat(e))},y=function(n){var e=c.replace(/([^\w])/g,"\\$1");return n.replace(new t.RegExp("^"+e),"")||""},m=e.location.pathname;i||(m=""),e.onpopstate=function(){p.add(function(){m=y(e.location.pathname),g(m),p.done()})},r("blob.route",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.path,e=n.handler;f(u(t),"on.blob.route : path is not a string",t),f(a(e),"on.blob.route : handler is not a function",t,e),f(a(s),"on.blob.route : register is not a function",s),p.add(function(){l=s(l,t,e),v||(v=!!g(m)),p.done()})}),r("blob.base",function(n){f(u(n),"on.blob.base : base url is not a string",n),p.add(function(){c=n,m=y(m),g(m),p.done()})}),r("blob.register",function(n){f(a(n),"on.blob.register : register is not a function",s),p.add(function(){s=n,p.done()})}),r("blob.fetch",function(n){f(a(n),"on.blob.fetch : fetch is not a function",h),p.add(function(){h=n,p.done()})}),r("redirect",function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(u(n),"on.redirect : path is not a string",n),f(d(r),"on.redirect : params is not an object",r),p.add(function(){m=n,i?e.history.pushState({},"",(c+m).replace(/^\/C\:/,"")):t.console.log("@okwolo : path changed to\n>>> "+m),g(m,r),p.done()})}),r("show",function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(u(n),"on.show : path is not a string",n),f(d(t),"on.show : params is not an object",t),p.add(function(){g(n,t),p.done()})}),o("blob.api",{redirect:function(n,t){return o("redirect",n,t)},show:function(n,t){return o("show",n,t)}})},function(n){(0,n.send)("blob.fetch",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!1;return n.find(function(n){var o=n.pattern.exec(t);if(null!==o)return r=!0,o.shift(),n.keys.forEach(function(n,t){e[n.name]=o[t]}),n.handler(e),r}),r})},function(n){(0,n.send)("blob.register",function(){var n,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1],o=arguments[2],i=(r.match(w)||[]).map(function(n){return{name:n.replace(/^:/g,"")}}),a=void 0;return"**"===r?a=/.*/g:(n=r.replace(/([^\w:])/g,"\\$1").replace(w,"([^/]*)"),a=new t.RegExp("^"+n+"(:?\\?.*)?$")),e.push({keys:i,pattern:a,handler:o}),e})},function(n){n.on;var t=n.send;t("blob.primary",function(n,e){a(n)?t("blob.builder",n()):t("blob.route",{path:n,handler:function(n){t("blob.builder",e(n))}})})}];y.kit="lite",y.version="3.3.0-rc.1",y.lite=y,t.okwolo=y}).call(this);