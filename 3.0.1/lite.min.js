(function(){"use strict";var n=this,t=function(t){var e=n.JSON.stringify(t,function(n,t){return"function"==typeof t?t.toString():t},2);return"\n>>> "+n.String(e).replace(/\n/g,"\n    ")},e=function(n){return void 0!==n},r=function(n){return null===n},o=function(t){return n.Array.isArray(t)},i=function(n){return"function"==typeof n},a=function(n){return"string"==typeof n},u=function(n){return"number"==typeof n},d=function(t){return!!t&&t.constructor===n.Object},c=function(n){return!!(n&&n.tagName&&n.nodeName&&n.ownerDocument&&n.removeAttribute)},l=function(t){if(void 0!==t)return n.JSON.parse(n.JSON.stringify(t))},f=function(e,r){for(var o=arguments.length,i=n.Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];if(!e)throw new n.Error("@okwolo."+r+i.map(t).join(""))},s=function(t,e){if(n.Array.isArray(t))return t;if(n.Symbol.iterator in n.Object(t))return function(t,e){var r=[],o=!0,i=!1,a=void 0;try{for(var u,d=t[n.Symbol.iterator]();!(o=(u=d.next()).done)&&(r.push(u.value),!e||r.length!==e);o=!0);}catch(n){i=!0,a=n}finally{try{!o&&d.return&&d.return()}finally{if(i)throw a}}return r}(t,e);throw new n.TypeError("Invalid attempt to destructure non-iterable instance")},b=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=null;return{addKey:function(n){return b([{key:n}].concat(t))},addTag:function(n){if(0===t.length)return b([{tag:n}]);var e=t.slice();return e[0].tag=n,b(e)},f:function(){if(!r(e))return e;e="root";for(var n=t.length-1;n>=0;--n){e+=" -> ";var o=t[n],i=o.tag,u=o.key;a(i)?e+=i.replace(/\|\s*[^]*$/g,"| ..."):e+="{{"+u+"}}"}return e},keyList:function(){var e=[];if(t.length<2)return[];for(var r=t.length-2;r>=0;--r)e.push(n.String(t[r].key));return e}}},v=function(){for(var t=arguments.length,e=n.Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.map(function(t){return a(t)?t:o(t)?v.apply(void 0,function(t){if(n.Array.isArray(t)){for(var e=0,r=n.Array(t.length);e<t.length;e++)r[e]=t[e];return r}return n.Array.from(t)}(t)):d(t)?v(n.Object.keys(t).map(function(n){return t[n]&&n})):void 0}).filter(n.Boolean).join(" ")},h=function(t,r){p.browser&&(e(r)||(f(void 0!==n.window,"app : must be run in a browser environment"),r=n.window));var u,c,l,s=function(){},b=function(){return s.apply(void 0,arguments)};return n.Object.assign(b,(u={},c={},{on:function(n,t){f(a(n),"on : handler type is not a string",n),f(i(t),"on : handler is not a function",t),e(u[n])||(u[n]=[]),u[n].push(t)},send:l=function(t){for(var e=arguments.length,r=n.Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];f(a(t),"send : event type is not a string",t);var d=u[t];if(o(d))for(var c=0;c<d.length;++c)d[c].apply(d,r)},use:function(t){for(var r=arguments.length,o=n.Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];if(a(t))l.apply(void 0,["blob."+t].concat(o));else{f(d(t),"use : blob is not an object",t);var u=t.name;if(e(u)){if(f(a(u),"utils.bus : blob name is not a string",u),e(c[u]))return;c[u]=!0}for(var s=n.Object.keys(t),b=0;b<s.length;++b){var v=s[b];l("blob."+v,t[v])}}}})),b.on("blob.api",function(t,e){f(d(t),"on.blob.api : additional api is not an object",t),n.Object.keys(t).forEach(function(n){e||f(!b[n],'on.blob.api : cannot add key "'+n+'" because it is already defined'),b[n]=t[n]})}),b.on("blob.primary",function(n){f(i(n),"on.blob.primary : primary is not a function",n),s=n}),y.forEach(function(n){n({on:b.on,send:b.send},r)}),e(t)&&b.use("target",t),b},p={kit:"lite",browser:!0},g=/:\w+/g,y=[function(n){var t=n.on,e=n.send,r={},o=r,a=void 0;t("state",function(n){o=n}),t("blob.handler",function(n){f(i(n),"on.blob.handler : handler generator is not a function",n);var t=n(function(){return o});f(i(t),"on.blob.handler : handler from generator is not a function",t),a=t}),e("blob.handler",function(){return function(n){e("state",n)}});e("blob.api",{setState:function(n){var t=i(n)?n(l(o)):n;a(t)},getState:function(){return f(o!==r,"state.getState : cannot get state before it has been set"),l(o)}})},function(t){var r=t.on,o=t.send,a=void 0,u=void 0,d=void 0,c=void 0,l=void 0,s=void 0,b=void 0;r("blob.target",function(n){a=n,o("update",!0)}),r("blob.builder",function(n){f(i(n),"on.blob.builder : builder is not a function",n),u=n,o("update",!1)}),r("blob.draw",function(n){f(i(n),"on.blob.draw : new draw is not a function",n),c=n,o("update",!0)}),r("blob.update",function(n){f(i(n),"on.blob.update : new target updater is not a function",n),l=n,o("update",!1)}),r("blob.build",function(n){f(i(n),"on.blob.build : new build is not a function",n),d=n,o("update",!1)}),r("state",function(n){f(e(n),"on.blob.state : new state is not defined",n),b=n,o("update",!1)});var v=!1,h=!1,p=null;r("update",function(t){if(!h){if(!(e(a)&&e(u)&&e(b)))return void(p||(p=n.setTimeout(function(){var t={builder:u,state:b,target:a};n.Object.keys(t).forEach(function(n){t[n]=t[n]?"ok":"waiting"}),f(h,"view : still waiting to draw after "+n.Math.round(3)+"s",t)},3e3)));h=!0}if(t||!v)return s=c(a,d(u(b))),void(v=!0);s=l(a,d(u(b)),[],s)}),r("sync",function(n,t){f(v,"view.sync : cannot sync component before app has drawn"),s=l(a,t,n,s)}),o("blob.api",{update:function(){return o("update",!1)}}),o("blob.primary",function(n){o("blob.builder",n())})},function(t){var c=t.send;c("blob.build",function t(l){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b();if("boolean"==typeof l&&(l=null),r(l))return{text:""};if(u(l)&&(l=n.String(l)),a(l))return{text:l};if(f(o(l),"view.build : vdom object is not a recognized type",h.f(),l),i(l[0])){var p=s(l,3),g=p[0],y=p[1],m=void 0===y?{}:y,w=p[2],O=void 0===w?[]:w;f(d(m),"view.build : component's props is not an object",h.f(),l,m),f(o(O),"view.build : component's children is not an array",h.f(),l,O);var k=void 0;return k=g(n.Object.assign({},m,{children:O}),function(){c("sync",h.keyList(),t(k.apply(void 0,arguments),h))}),t(k(),h)}var M=s(l,3),j=M[0],D=M[1],x=void 0===D?{}:D,A=M[2],S=void 0===A?[]:A;f(a(j),"view.build : tag property is not a string",h.f(),l,j),f(d(x),"view.build : attributes is not an object",h.f(),l,x),f(o(S),"view.build : children of vdom object is not an array",h.f(),l,S);var N=/^ *(\w+) *(?:#([-\w\d]+))? *((?:\.[-\w\d]+)*)? *(?:\|\s*([^\s]{1}[^]*?))? *$/.exec(j);f(o(N),"view.build : tag property cannot be parsed",h.f(),j);var E=s(N,5),C=E[1],T=E[2],$=E[3],J=E[4];e(T)&&!e(x.id)&&(x.id=T.trim()),(e(x.className)||e($))&&(x.className=v(x.className,$).replace(/\./g," ").replace(/  +/g," ").trim()),e(J)&&(e(x.style)?(J=(J+";").replace(/;;$/g,";"),x.style=J+x.style):x.style=J),h=h.addTag(j);for(var L={},q=[],B=0;B<S.length;++B){var F=S[B],I=B,K=t(F,h.addKey(I));K.attributes&&"key"in K.attributes&&(I=K.attributes.key,f(u(I)||a(I),"view.build : invalid element key type",h.f(),I),f(n.String(I).match(/^[\w\d-_]+$/g),"view.build : invalid character in element key",h.f(),I)),I=n.String(I),f(!L[I],"view.build : duplicate child key",h.f(),I),q.push(I),L[I]=K}return{tagName:C,attributes:x,children:L,childOrder:q}})},function(t,r){var o=t.send,a=function t(o){if(e(o.text))return o.DOM=r.document.createTextNode(o.text),o;var i=r.document.createElement(o.tagName);n.Object.assign(i,o.attributes);for(var a=0;a<o.childOrder.length;++a){var u=o.childOrder[a],d=t(o.children[u]).DOM;i.appendChild(d)}return o.DOM=i,o},u=function t(r,o,u,d){if(!e(r))return u.children[d]=a(o),void u.DOM.appendChild(u.children[d].DOM);if(!e(o))return u.DOM.removeChild(r.DOM),void delete u.children[d];if(r.tagName!==o.tagName){var c=r.DOM,l=a(o);return u.DOM.replaceChild(l.DOM,c),void n.Object.assign(r,{DOM:void 0,text:void 0,tagName:void 0,attributes:void 0,children:void 0,childOrder:void 0},l)}if(3!==r.DOM.nodeType){for(var f=function(t,e){for(var r=n.Object.keys(n.Object.assign({},t,e)),o=[],a=0;a<r.length;++a){var u=r[a],d=t[u],c=e[u];(i(d)||i(c))&&o.push(u),d!==c&&o.push(u)}return o}(r.attributes,o.attributes),s=0;s<f.length;++s){var b=f[s];r.attributes[b]=o.attributes[b],r.DOM[b]=o.attributes[b]}var v=r.childOrder.slice();r.childOrder=o.childOrder;for(var h=n.Object.keys(n.Object.assign({},r.children,o.children)),p=0;p<h.length;++p){var g=h[p];r.children[g]?o.children[g]||v.splice(v.indexOf(g),1):v.push(g),t(r.children[g],o.children[g],r,g)}if(v.length){for(var y=function(t,e){for(var r=e.length,o=r/2,i=0,a=0,u=0;u<r;++u){for(var d=t.indexOf(e[u]),c=n.Math.min(r-d,r-u),l=1,f=1;f<c&&e[u+f]===t[d+f];++f)l+=1;if(l>i&&(i=l,a=u),i>=o)break}return{start:a,end:a+i-1}}(v,o.childOrder),m=y.start,w=y.end,O=o.childOrder.slice(0,m),k=O.length-1;k>=0;--k){var M=O[k];r.DOM.insertBefore(r.children[M].DOM,r.DOM.firstChild)}for(var j=o.childOrder.slice(w+1,n.Infinity),D=0;D<j.length;++D){var x=j[D];r.DOM.appendChild(r.children[x].DOM)}}}else r.text!==o.text&&(r.DOM.nodeValue=o.text,r.text=o.text)};o("blob.draw",function(n,t){return f(c(n),"view.dom.draw : target is not a DOM node",n),a(t),r.requestAnimationFrame(function(){n.innerHTML="",n.appendChild(t.DOM)}),t}),o("blob.update",function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments[3];f(c(t),"view.dom.update : target is not a DOM node",t);for(var a={DOM:t,children:{root:i},childOrder:["root"]},d="root",l=i,s=0;s<o.length;++s)d=o[s],a=l,l=l.children[d];return r.requestAnimationFrame(function(){try{u(l,e,a,d)}catch(t){n.console.error("view.dom.update : "+t)}}),i})},function(t,e){var r,o,u=t.on,c=t.send,l=null!==e.document.origin&&"null"!==e.document.origin,s="",b=void 0,v=void 0,h=void 0,p=!1,g=(r=[],o=function(){var n=r[0];n&&n()},{add:function(n){r.push(n),1===r.length&&o()},done:function(){r.shift(),o()}}),y=function(){for(var t=arguments.length,e=n.Array(t),r=0;r<t;r++)e[r]=arguments[r];f(i(h),"router : fetch is not a function",h),h.apply(void 0,[b].concat(e))},m=function(t){var e=s.replace(/([^\w])/g,"\\$1");return t.replace(new n.RegExp("^"+e),"")||""},w=e.location.pathname;l||(w=""),e.onpopstate=function(){g.add(function(){w=m(e.location.pathname),y(w),g.done()})},u("blob.route",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.path,e=n.handler;f(a(t),"on.blob.route : path is not a string",t),f(i(e),"on.blob.route : handler is not a function",t,e),f(i(v),"on.blob.route : register is not a function",v),g.add(function(){b=v(b,t,e),p||(p=!!y(w)),g.done()})}),u("blob.base",function(n){f(a(n),"on.blob.base : base url is not a string",n),g.add(function(){s=n,w=m(w),y(w),g.done()})}),u("blob.register",function(n){f(i(n),"on.blob.register : register is not a function",v),g.add(function(){v=n,g.done()})}),u("blob.fetch",function(n){f(i(n),"on.blob.fetch : fetch is not a function",h),g.add(function(){h=n,g.done()})}),u("redirect",function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(a(t),"on.redirect : path is not a string",t),f(d(r),"on.redirect : params is not an object",r),g.add(function(){w=t,l?e.history.pushState({},"",(s+w).replace(/^\/C\:/,"")):n.console.log("@okwolo : path changed to\n>>> "+w),y(w,r),g.done()})}),u("show",function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(a(n),"on.show : path is not a string",n),f(d(t),"on.show : params is not an object",t),g.add(function(){y(n,t),g.done()})}),c("blob.api",{redirect:function(n,t){return c("redirect",n,t)},show:function(n,t){return c("show",n,t)}})},function(n){(0,n.send)("blob.fetch",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!1;return n.find(function(n){var o=n.pattern.exec(t);if(null!==o)return r=!0,o.shift(),n.keys.forEach(function(n,t){e[n.name]=o[t]}),n.handler(e),r}),r})},function(t){(0,t.send)("blob.register",function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1],o=arguments[2],i=(r.match(g)||[]).map(function(n){return{name:n.replace(/^:/g,"")}}),a=void 0;return"**"===r?a=/.*/g:(t=r.replace(/([^\w:])/g,"\\$1").replace(g,"([^/]*)"),a=new n.RegExp("^"+t+"(:?\\?.*)?$")),e.push({keys:i,pattern:a,handler:o}),e})},function(n){n.on;var t=n.send;t("blob.primary",function(n,e){i(n)?t("blob.builder",n()):t("blob.route",{path:n,handler:function(n){t("blob.builder",e(n))}})})}];h.kit="lite",h.version="3.0.1",h.lite=h,n.okwolo=h}).call(this);