(function(){"use strict";var n={enumerable:!1,configurable:!0,writable:!0},t=this.Object.defineProperty,e=function(n){var t=JSON.stringify(n,function(n,t){return"function"==typeof t?t.toString():t},2);return"\n>>> "+String(t).replace(/\n/g,"\n    ")},r=function(n){return void 0!==n},o=function(n){return Array.isArray(n)},i=function(n){return"function"==typeof n},a=function(n){return"string"==typeof n},u=function(n){return!!n&&n.constructor===Object},d=function(n){if(void 0!==n)return JSON.parse(JSON.stringify(n))},c=function(n,t){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];if(!n)throw new Error("@okwolo."+t+o.map(e).join(""))},l=function(){var n=[],t=function(){var t=n[0];t&&t()};return{add:function(e){n.push(e),1===n.length&&t()},done:function(){n.shift(),t()}}},f=function(){for(var n=arguments.length,t=Array(n),e=0;e<n;e++)t[e]=arguments[e];return t.map(function(n){return a(n)?n:o(n)?f.apply(void 0,function(n){if(Array.isArray(n)){for(var t=0,e=Array(n.length);t<n.length;t++)e[t]=n[t];return e}return Array.from(n)}(n)):u(n)?f(Object.keys(n).map(function(t){return n[t]&&t})):void 0}).filter(Boolean).join(" ")},s=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.list=n;for(var t="#",e=0;e<this.list.length;++e){t+="→ ";var r=this.list[e].tag;t+=r.substr(0,16),r.length>16&&(t+="...")}this.formatted=t},b=s.prototype,h=function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return function(n,t){var e=[],r=!0,o=!1,i=void 0;try{for(var a,u=n[Symbol.iterator]();!(r=(a=u.next()).done)&&(e.push(a.value),!t||e.length!==t);r=!0);}catch(n){o=!0,i=n}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return e}(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},v=function(n,t){p.browser&&(g.defined(t)||(c("undefined"!=typeof window,"app : must be run in a browser environment"),t=window));var e,o=function(){},d=function(){return o.apply(void 0,arguments)},l=(e={},{on:function(n,t){c(a(n),"on : handler type is not a string",n),c(i(t),"on : handler is not a function",t),r(e[n])||(e[n]=[]),e[n].push(t)},send:function(n){for(var t=arguments.length,o=Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];c(a(n),"send : event type is not a string",n);var u=e[n];if(r(u))for(var d=0;d<u.length;++d)u[d].apply(u,o)}}),f=l.on,s=l.send,b=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e){for(var o=arguments.length,i=Array(o>1?o-1:0),d=1;d<o;d++)i[d-1]=arguments[d];if(a(e))n.apply(void 0,["blob."+e].concat(i));else{c(u(e),"use : blob is not an object",e);var l=e.name;if(r(l)){if(c(a(l),"utils.bus : blob name is not a string",l),r(t[l]))return;t[l]=!0}Object.keys(e).forEach(function(t){n("blob."+t,e[t])})}}}(s,{});return Object.assign(d,{on:f,send:s,use:b}),d.on("blob.api",function(n,t){c(g.object(n),"on.blob.api : additional api is not an object",n),Object.keys(n).forEach(function(e){t||c(!d[e],'on.blob.api : cannot add key "'+e+'" because it is already defined'),d[e]=n[e]})}),d.on("blob.primary",function(n){c(g.function(n),"on.blob.primary : primary is not a function",n),o=n}),w.forEach(function(n){n({on:d.on,send:d.send},t)}),g.defined(n)&&d.send("blob.target",n),d},p={kit:"lite",browser:!0},g={array:o,boolean:function(n){return"boolean"==typeof n},defined:r,function:i,node:function(n){return!!(n&&n.tagName&&n.nodeName&&n.ownerDocument&&n.removeAttribute)},null:function(n){return null===n},number:function(n){return"number"==typeof n},object:u,regExp:function(n){return n instanceof RegExp},string:a},y=this;n.value=function(n){return void 0===n?this.formatted:this.formatted+"→ {{"+n+"}}"},t(b,"f",n),n.value=function(n,t){return new s(this.list.concat([{tag:n,key:t}]))},t(b,"add",n),n.value=function(n,t){return this.list.push({tag:n,key:t}),this},t(b,"addUnsafe",n),n.value=function(){return new s(this.list.slice())},t(b,"copy",n),n.value=function(){if(this.list.length<2)return[];for(var n=Array(this.list.length-1),t=0;t<n.length;++t)n[t]=this.list[t+1].key;return n},t(b,"keys",n);var m=/:\w+/g,w=[function(n){var t=n.on,e=n.send,r={},o=r,i=void 0;t("state",function(n){o=n}),t("blob.handler",function(n){c(g.function(n),"on.blob.handler : handler generator is not a function",n);var t=n(function(){return o});c(g.function(t),"on.blob.handler : handler from generator is not a function",t),i=t}),e("blob.handler",function(){return function(n){e("state",n)}});e("blob.api",{setState:function(n){var t=g.function(n)?n(d(o)):n;i(t)},getState:function(){return c(o!==r,"state.getState : cannot get state before it has been set"),d(o)}})},function(n){var t=n.on,e=n.send,r=void 0,o=void 0,i=void 0,a=void 0,u=void 0,d=void 0,f=void 0;t("blob.target",function(n){r=n,e("update",!0)}),t("blob.builder",function(n){c(g.function(n),"on.blob.builder : builder is not a function",n),o=n,e("update",!1)}),t("blob.draw",function(n){c(g.function(n),"on.blob.draw : new draw is not a function",n),a=n,e("update",!0)}),t("blob.update",function(n){c(g.function(n),"on.blob.update : new target updater is not a function",n),u=n,e("update",!1)}),t("blob.build",function(n){c(g.function(n),"on.blob.build : new build is not a function",n),i=n,e("update",!1)}),t("state",function(n){c(g.defined(n),"on.state : new state is not defined",n),f=n,e("update",!1)});var s=!1,b=!1,h=null;t("update",function(n){if(!b){if(!(g.defined(r)&&g.defined(o)&&g.defined(f)))return void(h||(h=setTimeout(function(){var n={builder:o,state:f,target:r};Object.keys(n).forEach(function(t){n[t]=n[t]?"ok":"waiting"}),c(b,"view : still waiting to draw after "+Math.round(3)+"s",n)},3e3)));b=!0}var t=l();if(n||!s)return d=a(r,i(o(f),t)),s=!0,void t.done();d=u(r,i(o(f),t),[],d),t.done()}),t("sync",function(n,t,e){c(s,"view.sync : cannot sync component before app has drawn"),d=u(r,t,n,d,e)}),e("blob.api",{update:function(){y.console.warn("@okwolo.update : function will be deprecated in next major version (4.x)"),e("update",!1)}}),e("blob.primary",function(n){e("blob.builder",n())})},function(n,t){var e=n.send,r=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,t={},e=[];return{set:function(r,o){t[r]=o,e.push(r),e.length>n&&(t[e.shift()]=void 0)},get:function(n){return t[n]}}}(1e3);e("blob.build",function(n,t){return t.add(Function),function n(t,o,i,a,u,d){if(g.boolean(t)&&(t=""),g.null(t)&&(t=""),g.number(t)&&(t+=""),g.string(t))return u&&i.addUnsafe("textNode",a),{text:t,componentIdentity:d};var l=i.f(a);if(c(g.array(t),"view.build : vdom object is not a recognized type",l,t),g.function(t[0])){var s=h(t,3),b=s[0],v=s[1],p=void 0===v?{}:v,y=s[2],m=void 0===y?[]:y;c(g.object(p),"view.build : component's props is not an object",l,t,p),c(g.array(m),"view.build : component's children is not an array",l,t,m);var w=void 0,O=i;return u||(O=i.copy(),d={}),w=b(Object.assign({},p,{children:m}),function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];o.add(function(){e("sync",O.keys(),n(w.apply(void 0,r),o,O,a,!1,d),d),o.done()})}),c(g.function(w),"view.build : component should return a function",l,w),n(w(),o,O,a,!0,d)}var k=h(t,3),j=k[0],x=k[1],M=void 0===x?{}:x,D=k[2],A=void 0===D?[]:D;c(g.string(j),"view.build : tag property is not a string",l,t,j),c(g.object(M),"view.build : attributes is not an object",l,t,M),c(g.array(A),"view.build : children of vdom object is not an array",l,t,A);var E=r.get(j);g.defined(E)||(E=/^ *?(\w+?) *?(?:#([-\w\d]+?))? *?((?:\.[-\w\d]+?)*?)? *?(?:\|\s*?([^\s][^]*?))? *?$/.exec(j),c(g.array(E),"view.build : tag property cannot be parsed",l,j),r.set(j,E));var N=h(E,5),S=N[1],C=N[2],I=N[3],$=N[4];g.defined(C)&&!g.defined(M.id)&&(M.id=C.trim()),(g.defined(M.className)||g.defined(I))&&(M.className=f(M.className,I).replace(/\./g," ").replace(/  +/g," ").trim()),g.defined($)&&(g.defined(M.style)?M.style=($+";").replace(/;;$/g,";")+M.style:M.style=$);var T=a;"key"in M&&(T=M.key,c(g.number(T)||g.string(T),"view.build : invalid element key type",l,T),c((T=""+T).match(/^[\w\d-_]+$/g),"view.build : invalid character in element key",l,T),M.key=T),d?u&&i.addUnsafe(j,T):i=i.add(j,T);for(var R={},F=[],J=0;J<A.length;++J){var U=A[J],q=""+J,B=n(U,o,i,q);B.attributes&&"key"in B.attributes&&(q=B.attributes.key),c(!R[q],"view.build : duplicate child key (note that text elements and elements with no key attribute are given their array index as key)",i.f(),q),F.push(q),R[q]=B}return{tagName:S,attributes:M,children:R,childOrder:F,componentIdentity:d}}(n,t,new s)})},function(n,t){var e=n.send,r=function n(e){if(g.defined(e.text))return e.DOM=t.document.createTextNode(e.text),e;var r=t.document.createElement(e.tagName);Object.assign(r,e.attributes);for(var o=0;o<e.childOrder.length;++o){var i=e.childOrder[o],a=n(e.children[i]).DOM;r.appendChild(a)}return e.DOM=r,e},o=function n(t,e,o,a,u){if(g.defined(e)){if(!g.defined(o)){var d=a.DOM,c=e.DOM;return t.push(function(){d.removeChild(c)}),void delete a.children[u]}if(e.componentIdentity=o.componentIdentity,e.tagName!==o.tagName){var l=e.DOM,f=r(o),s=a.DOM,b=f.DOM;return t.push(function(){s.replaceChild(b,l)}),void Object.assign(e,{DOM:void 0,text:void 0,tagName:void 0,attributes:void 0,children:void 0,childOrder:void 0},f)}if(void 0===e.text){for(var h=function(n,t){for(var e=Object.keys(Object.assign({},n,t)),r=[],o=0;o<e.length;++o){var a=e[o],u=n[a],d=t[a];i(u)||i(d)?r.push(a):u!==d&&r.push(a)}return r}(e.attributes,o.attributes),v=function(n){var r=h[n],i=o.attributes[r];e.attributes[r]=i;var a=e.DOM;t.push(function(){a[r]=i})},p=0;p<h.length;++p)v(p);var y=e.childOrder.slice();e.childOrder=o.childOrder;var m=Object.keys(Object.assign({},e.children,o.children));for(p=0;p<m.length;++p){var w=m[p];e.children[w]?o.children[w]||y.splice(y.indexOf(w),1):y.push(w),n(t,e.children[w],o.children[w],e,w)}if(y.length){for(var O=function(n,t){for(var e=t.length,r=e/2,o=0,i=0,a=0;a<e;++a){for(var u=n.indexOf(t[a]),d=Math.min(e-u,e-a),c=1,l=1;l<d&&t[a+l]===n[u+l];++l)c+=1;if(c>o&&(o=c,i=a),o>=r)break}return{start:i,end:i+o-1}}(y,o.childOrder),k=O.start,j=O.end,x=o.childOrder.slice(0,k),M=function(n){var r=x[n],o=e.DOM,i=e.children[r].DOM;t.push(function(){o.insertBefore(i,o.firstChild)})},D=x.length-1;D>=0;--D)M(D);for(var A=o.childOrder.slice(j+1,1/0),E=function(n){var r=A[n],o=e.DOM,i=e.children[r].DOM;t.push(function(){o.appendChild(i)})},N=0;N<A.length;++N)E(N)}}else{var S=o.text;if(e.text!==S){var C=e.DOM;t.push(function(){C.nodeValue=S}),e.text=S}}}else{a.children[u]=r(o);var I=a.DOM,$=a.children[u].DOM;t.push(function(){I.appendChild($)})}};e("blob.draw",function(n,e){return c(g.node(n),"view.dom.draw : target is not a DOM node",n),r(e),t.requestAnimationFrame(function(){n.innerHTML="",n.appendChild(e.DOM)}),e}),e("blob.update",function(n,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments[3],a=arguments[4];c(g.node(n),"view.dom.update : target is not a DOM node",n);for(var u={DOM:n,children:{root:i},childOrder:["root"]},d="root",l=i,f=0;f<r.length;++f)if(d=r[f],u=l,l=l.children[d],!g.defined(l))return t.console.warn("view.dom.update : target of update does not exist (this could be caused by a component update function being called on a componenent that no longer exists)"),i;if(a&&l.componentIdentity!==a)return t.console.warn("view.dom.update : target of update has incorrect identity (this is generally caused by a component update function being called on a component that no longer exists)"),i;var s=[];return o(s,l,e,u,d),t.requestAnimationFrame(function(){try{for(var n=0;n<s.length;++n)s[n]()}catch(n){t.console.error("view.dom.update : error when applying computed changes"+n)}}),i})},function(n,t){var e=n.on,r=n.send,o=void 0,i="",a=void 0,u=void 0,d=!1,f=t.location.pathname,s=null!==t.document.origin&&"null"!==t.document.origin;s||(f="");var b=l(),h=function(n){var t=i.replace(/([^\w])/g,"\\$1");return n.replace(new RegExp("^"+t),"")||""};t.onpopstate=function(){b.add(function(){f=h(t.location.pathname),u(o,f),b.done()})},e("blob.route",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.path,e=n.handler;c(g.string(t)||g.regExp(t),"on.blob.route : path is not a string or a regular expression",t),c(g.function(e),"on.blob.route : handler is not a function",t,e),c(g.function(a),"on.blob.route : register is not a function",a),b.add(function(){o=a(o,t,e),d||(d=!!u(o,f)),b.done()})}),e("blob.base",function(n){c(g.string(n),"on.blob.base : base url is not a string",n),b.add(function(){i=n,f=h(f),u(o,f),b.done()})}),e("blob.register",function(n){c(g.function(n),"on.blob.register : register is not a function",a),b.add(function(){a=n,b.done()})}),e("blob.fetch",function(n){c(g.function(n),"on.blob.fetch : fetch is not a function",u),b.add(function(){u=n,b.done()})}),e("redirect",function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(g.string(n),"on.redirect : path is not a string",n),c(g.object(e),"on.redirect : params is not an object",e),b.add(function(){f=n,s?t.history.pushState({},"",(i+f).replace(/^\/C\:/,"")):console.log("@okwolo : path changed to\n>>> "+f),u(o,f,e),b.done()})}),e("show",function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(g.string(n),"on.show : path is not a string",n),c(g.object(t),"on.show : params is not an object",t),b.add(function(){u(o,n,t),b.done()})}),r("blob.api",{redirect:function(n,t){return r("redirect",n,t)},show:function(n,t){return r("show",n,t)}})},function(n){(0,n.send)("blob.fetch",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!1;return n.find(function(n){var o=n.pattern.exec(t);if(null!==o)return r=!0,o.shift(),n.keys.forEach(function(n,t){e[n.name]=o[t]}),n.handler(e),r}),r})},function(n){(0,n.send)("blob.register",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],e=arguments[2];if("**"===t)return n.push({keys:[],pattern:/.*/g,handler:e}),n;if(g.regExp(t)){var r=new RegExp(t.toString()+"|").exec("").length-1;return n.push({keys:Array(r).fill(0).map(function(n,t){return{name:t}}),pattern:t,handler:e}),n}var o=(t.match(m)||[]).map(function(n){return{name:n.replace(/^:/g,"")}});return n.push({keys:o,pattern:function(n){var t=n.replace(/([^\w:])/g,"\\$1").replace(m,"([^/#?]*)");return new RegExp("^"+t+"(:?[?#][^]*)?$")}(t),handler:e}),n})},function(n){n.on;var t=n.send;t("blob.primary",function(n,e){g.function(n)?t("blob.builder",n()):t("blob.route",{path:n,handler:function(n){t("blob.builder",e(n))}})})}];v.kit="lite",v.version="3.4.1",v.lite=v,this.okwolo=v}).call(this);